id: push_to_github
namespace: zoomcamp
description: |
  The CSV Data used in the course: https://github.com/DataTalksClub/nyc-tlc-data/releases

variables:
  gh_username: mnaufalazwar
  gh_repo: https://github.com/mnaufalazwar/kestra-zoomcamp-flows-tutorial

tasks:
  - id: push_flows
    type: io.kestra.plugin.git.PushFlows
    sourceNamespace: zoomcamp
    targetNamespace: zoomcamp
    flows:
      - 02_postgres_taxi
      - 02_postgres_taxi_scheduled
      - 03_postgres_dbt
      - 05_gcp_setup
      - 06_gcp_taxi
      - 07_gcp_dbt
      - push_to_github
    includeChildNamespaces: true
    gitDirectory: _flows
    url: "{{ vars.gh_repo }}"
    username: "{{ vars.gh_username }}"
    password: "{{kv('GITHUB_ACCESS_TOKEN')}}"
    branch: develop
    commitMessage: add flows {{ now() }}
